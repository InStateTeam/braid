<template id="app-console-template">
  <link rel="stylesheet" href="../style.css">
  <div class="widget">
    <label for="console">Console</label>
    <textarea class="output" readonly id="console"></textarea>
    <button id="clear-console">clear</button>
  </div>
  <style>
    .output {
      width: 100%;
      height: 30em;
      flex: 1;
      resize: none;
      border: none;
      font-family: monospace;
      font-size: 16px;
      padding: 0;
      margin: 0;
    }
  </style>
</template>

<script>
  const INFO = '[INFO ]';
  const WARN = '[WARN ]';
  const ERROR = '[ERROR]';

  (function() {
    class AppConsole extends SimpleComponent {
      constructor() {
        super('app-console-template');
      }

      connectedCallback() {
        const thisObj = this;
        this.$('#clear-console').onclick = () => thisObj._onClearConsole();
      }

      disconnectedCallback() {
        this.$('#clear-console').onclick = null;
      }

      _onClearConsole() {
        this.$('#console').value = "";
      }

      log() {
        this.logAtLevel(INFO, this._foldArguments(arguments));
      }

      info() {
        this.log(...arguments)
      }

      error() {
        this.logAtLevel(ERROR, this._foldArguments(arguments));
      }

      warn() {
        this.logAtLevel(WARN, this._foldArguments(arguments));
      }

      logAtLevel(level, line) {
        const now = new Date()
        const time = now.toLocaleTimeString() + ':' + ('00' + now.getMilliseconds()).slice(-3);
        line = level + ' ' + time + ' - ' + line;

        const output = this.$('#console');

        output.value = output.value + '\n' + line;

        output.scrollTop = output.scrollHeight;
      }

      _foldArguments(args) {
        let arr = [];
        for (let idx in args) {
          let arg = args[idx];
          if (typeof arg === 'object') {
            arg = JSON.stringify(arg)
          }
          arr[idx] = "" + arg;
        }

        const line = arr.reduce((acc, current) => acc + current + ' ', '');
        return line;
      }
    }


    window.customElements.define('app-console', AppConsole);
  })();

</script>